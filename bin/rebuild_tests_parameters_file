#!/bin/bash

paramFile="./tests_parameters/parameters"

if [ -f "$paramFile" ]
then
	cp $paramFile /tmp
	echo "(The previous 'parameters' file has been copied to /tmp in case you need it.)"
fi

echo "################################################################################
#
# This is the parameters file for your tests. If any of these are left blank,
# you will be prompted for a value when you run that test.
#
# There must be no space between the "=" and your value.
#
# It is advisable to make a copy of this file once you have put your values
# into it (if you pull this repository from GitHub again, your changes
# will be lost).
#
" > $paramFile

ls tests/test_[0-9]*.py | while read testfile
do
	NUM=$(echo $testfile | sed -e "s/^.*test_\([^\.]*\).py/\1/")
	DESC=$(grep "_Description" $testfile | sed -e "s/^.*=//")

	EXT_VARS=""
	while read line
	do
		x=$(echo $line | sed -e "s/^.*.get_os_variable//")
		x=$(echo $x | sed -e "s/^(\(.*\))$/\1/")
		VARNAME=$(echo $x | awk 'BEGIN{FS=","}{print $1}' | sed -e "s/^.*\"\(.*\)\" *$/\1/")
		VARDESC=$(echo $x | awk 'BEGIN{FS=","}{print $2}' | sed -e "s/^.*\"\(.*\)\" *$/\1/")

		#
		# Ignore this varname - it's just for prompting.
		#
		if [ "$VARNAME" = "ENTER" ]
		then
			continue
		fi

		if [ "$VARNAME" ]
		then
			EXT_VARS="${EXT_VARS}export $VARNAME=\t\t# $VARDESC\n"
		fi
	done << EOF
	$(grep ".get_os_variable" $testfile | sed -e "s/^[ ]*//" | egrep -v "#")
EOF

	if [ "$EXT_VARS" ]
	then
		echo ""
		echo "#"
		echo "# Test number: $NUM"
		echo "# Test desc. : $DESC"
		echo "#"
		printf "$EXT_VARS"
	fi
done >> $paramFile
